# üìäü§ñ Sample Test Data Generator for demo projects

## üöÄ Introduction

This project generates synthetic data for user profiles, products, and financial transactions. It uses the Faker library to create realistic-looking sample data and DuckDB to query it. You can run it within a Docker container or locally. 

You can perform SQL joins because data is generated by considering relations between its tables. 

You can also run any other pandas, polars or Spark processing with the available csvs.

## üìù Prerequisites

- Docker Desktop (if using the Docker)
- Python 3.9 (if running locally)
- `pip` (if running locally)
- Make (optional, for simplified commands)

## Setup and Usage

### üì¶ Using Docker

1. **Build the Docker Image**

   First, you need to build the Docker image that contains all the necessary dependencies. Run the following command in your terminal:

```sh 
make build
```

2. **Run the Docker Container**
  Once the image is built, you can run the container with a default of 1000 records:

```sh 
make run
```

   Override number of generated rows (per table) on the command line:

```sh
make run NUM_RECORDS=5000
```
  
  Optional: you can run this command to have the csvs available in your local if using Docker.

```sh 
make csvs
``` 

   This will generate the sample test data and output csv and the duckdb database to have available in your machine.

3. **Access the DuckDB Database**
    After running the container, you are inside the DuckDB database from within the container or copy the database file to your local machine for further analysis.

    You can run any queries you like:

```sh
SELECT * FROM user_profiles LIMIT 5;

SELECT DISTINCT product_name, category
FROM products
LEFT JOIN transactions ON products.product_id = transactions.product_id
LIMIT 5;

SELECT DISTINCT product_name, category, user_id, transaction_type, amount
FROM products
LEFT JOIN transactions ON products.product_id = transactions.product_id
LIMIT 5;
```

To exit the DuckDB shell, use Ctrl+C or Ctrl+D. You can always open DuckDB again by running:

```sh 
make duckdb
``` 

4. **Clean the container**

This command will remove the container, the image and any files that were copied:

```sh 
make clean
```

### üñ•Ô∏è Running Locally

1. **Install requirements.txt**

```sh 
pip install requirements.tzt 
```

2. **Generate Data**

```sh 
NUM_RECORDS=1000  # Adjust the number as needed (falls back to 1000 if unset or invalid)
python3 generate_data.py
```
3. **Access DuckDB Database**

```sh
duckdb sampledata_duckdb.db 
```

4. **Clean up files**

You can run this script to clean up .csv and .db files

```sh
python3 clean_files.py
```

### üîÉ Data Modeling
Here's a graphic representation on how the datasets are related to each other.

![Data Modeling](schema.png)

### üìÅ Output Format
The script generates the following output files:

- user_profiles.csv: Contains user profile data.
- products.csv: Contains product data.
- transactions.csv: Contains financial transaction data.

These CSV files are then imported into a DuckDB database named sampledata_duckdb.db, with tables corresponding to each CSV file.

## üõ†Ô∏è Troubleshooting

### Docker build error: "Cannot connect to the Docker daemon ... Is the docker daemon running?"
### Runtime error: `ValueError: invalid literal for int() with base 10: ''`
Cause: An empty environment variable `NUM_RECORDS` was passed into the container (previous behavior before robust parsing). The code now safely falls back to 1000, but if you encounter this elsewhere:

Fix:
```bash
make run NUM_RECORDS=1000
```
or ensure you are not exporting an empty value:
```bash
unset NUM_RECORDS
```
If `make build` fails with an error similar to:

```
ERROR: Cannot connect to the Docker daemon at unix:///Users/<you>/.docker/run/docker.sock. Is the docker daemon running?
```

Follow these steps (macOS):

1. Start Docker Desktop (if not already running):
  ```bash
  open -a Docker
  ```
  Wait until the whale icon stops animating and shows "Docker is running".

2. Verify the CLI can talk to the daemon:
  ```bash
  docker version
  docker info
  ```

3. Check that `DOCKER_HOST` is not overriding the default socket:
  ```bash
  echo "$DOCKER_HOST"
  ```
  If it prints a custom path (e.g. `unix:///Users/.../.docker/run/docker.sock`), unset it for the session:
  ```bash
  unset DOCKER_HOST
  ```

4. Ensure you're using the default context:
  ```bash
  docker context ls
  docker context use default
  ```

5. Retry the build:
  ```bash
  make build
  ```

6. Still failing? Restart Docker Desktop (tray menu ‚Üí Troubleshoot ‚Üí Restart) or view backend logs:
  ```bash
  tail -n 200 ~/Library/Containers/com.docker.docker/Data/log/host/com.docker.backend.log
  ```

### Optional: Preflight check target
You can add this to the `Makefile` to fail fast if Docker is not reachable:
```makefile
check-docker:
	@docker info >/dev/null 2>&1 || { echo 'Docker not running or not reachable'; exit 1; }

build: check-docker
```
Then run `make build` as usual.

### Common Cleanup
If a previous failed build left a dangling container/image:
```bash
docker ps -a
docker rm <stopped-container-id>
docker image prune -f
```

If permissions on the socket are wrong (rare on macOS): restart Docker Desktop‚Äîmanual chmod is usually unnecessary.

### Container name conflict: "Conflict. The container name \"/sample-data-container\" is already in use"
Cause: A container with that name already exists (possibly from a previous run).

Fix options:
```bash
make clean                      # stops/removes then you can run again
docker rm -f sample-data-container  # just remove the old container
make run NUM_RECORDS=2000       # rerun with desired size
```
Automation: The `make run` target now auto-removes an existing container with the same name before starting.

### duckdb: command not found / "No such file or directory"
Cause: The DuckDB CLI isn't installed on your host. Data generation still succeeded; only the automatic interactive shell failed.

Install (macOS/Homebrew):
```bash
brew install duckdb
```

Verify:
```bash
duckdb --version
```

Alternative (query via Python instead of installing CLI):
```bash
python -c "import duckdb; con=duckdb.connect('sampledata_duckdb.db'); print(con.execute('SELECT COUNT(*) FROM user_profiles').fetchall())"
```

##### üòé [Follow me on Linkedin](https://www.linkedin.com/in/rappapurapu/)
- Get tips, learnings and tricks for Datascience career!

